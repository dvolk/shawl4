---
- hosts: localhost
  connection: local
  tasks:
    - name: Install python 3.6
      yum:
        name:
          - python3
          - python3-devel
          - python3-pip

    - name: Clone latest version of shawl
      git:
        repo: https://github.com/dvolk/shawl4
        dest: /opt/shawl4

    - name: Upgrade pip
      pip:
        executable: /usr/bin/pip3
        name: pip
        state: latest

    - name: Install shawl reqs
      pip:
        executable: /usr/bin/pip3
        name:
          - argh
          - flask
          - humanize
          - paramiko
          - scp
          - markdown2

    - name: Copy shawl systemd service file
      template:
        src: "/opt/shawl4/shawl.service"
        dest: "/etc/systemd/system/shawl.service"

    - name: reload systemd user service
      ansible.builtin.systemd:
        daemon_reexec: yes

    - name: enable and start shawl service
      ansible.builtin.systemd:
        name: shawl
        state: started
        enabled: yes
